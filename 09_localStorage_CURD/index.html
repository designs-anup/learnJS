<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage :: CURD</title>
</head>
<body>
    <h1>CURD basic using LocalStorage</h1>

    <form id="create_form">
        <input type="text" placeholder="name" class="createName" />
        <input type="text" placeholder="email" class="createEmail">
        <button class="create">Create</button>
    </form>

    <form id="update_form">
        <input type="text" placeholder="name" class="updateName" />
        <input type="text" placeholder="email" class="updateEmail">
        <button class="update">Update</button>
    </form>

    <div id="studentInfo"></div>
    <div id="displayInfo">
        <table>
            <thead>
                <tr>
                    <td><strong>Name</strong</td>
                    <td><strong>Email</strong</td>
                    <td><strong>Action</strong</td>
                </tr>
            </thead>
            <tbody class="tableBody"></tbody>
        </table>
    </div>
<script>
// select Elements
const createForm = document.getElementById('create_form')
const updateForm = document.getElementById('update_form')

const studentInfo = document.getElementById('studentInfo')
const displayInfo = document.getElementById('displayInfo')

let localContent = JSON.parse(localStorage.getItem('studentDetails')) || [];

let editIndex = null

renderTable()

createForm.addEventListener('submit', function(e){
    e.preventDefault()
    const name = this.querySelector('.createName').value
    const email = this.querySelector('.createEmail').value

    localContent.push({name,email})
    // console.log(localContent);
    localStorage.setItem('studentDetails', JSON.stringify(localContent))
    this.reset()
    
    renderTable()
})

updateForm.addEventListener('submit', (e) => {
    e.preventDefault()
    const name = updateForm.querySelector('.updateName').value
    const email = updateForm.querySelector('.updateEmail').value

    // console.log(localContent[editIndex])
    localContent[editIndex] = {name, email}

    localStorage.setItem('studentDetails', JSON.stringify(localContent))
    updateForm.reset()
    renderTable()
})

function renderTable(){
    studentInfo.innerHTML = "<h2>Out Area in JSON format</h2>" + localStorage.getItem('studentDetails')

    let tbody = document.querySelector('.tableBody')       
    let displayTablelist = ''

    localContent.forEach(function(item, index){
        displayTablelist += `<tr>
                            <td>${item.name}</td>
                            <td>${item.email}</td>
                            <td><button class="edit-btn" data-index="${index}">Edit</button></td>
                            <td><button class="delete-btn" data-index="${index}">Update</button></td>
                        </tr>`
    })

    tbody.innerHTML = displayTablelist

    document.querySelectorAll('.edit-btn').forEach((button) => {
        // console.log(button)
        button.addEventListener("click", () => {
            // console.log(button.getAttribute('data-index'));
            editIndex = button.getAttribute('data-index');
            // console.log(localContent[editIndex])
            let item = localContent[editIndex]
            // console.log(item.name);
            // console.log(item.email);

            updateForm.querySelector('.updateName').value = item.name
            updateForm.querySelector('.updateEmail').value = item.email


        })
    })
}

</script>
</body>
</html>